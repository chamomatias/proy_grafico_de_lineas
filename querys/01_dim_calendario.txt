let
    // 1. Origen de datos: tu tabla con la columna fecha
    Origen       = #"02_fact_table",

    // 2. Calcular fecha mínima y máxima de tu conjunto
    FechaMin     = List.Min(Origen[fecha]),
    FechaMax     = List.Max(Origen[fecha]),

    // 3. Definir rango completo: 1-ene del año de FechaMin hasta 31-dic del año de FechaMax
    Inicio       = #date(Date.Year(FechaMin), 1, 1),
    Fin          = #date(Date.Year(FechaMax), 12, 31),
    DiasTotales  = Duration.Days(Fin - Inicio) + 1,

    // 4. Generar la lista de fechas y convertirla en tabla
    ListaFechas  = List.Dates(Inicio, DiasTotales, #duration(1,0,0,0)),
    Calendario0  = Table.FromList(ListaFechas, Splitter.SplitByNothing(), {"fecha"}),
    Calendario   = Table.TransformColumnTypes(Calendario0, {{"fecha", type date}}),

    // 5. Añadir columnas obligatorias
    AñadirAño        = Table.AddColumn(Calendario,     "anio",         each Date.Year([fecha]),                                Int64.Type),
    AñadirTrimNro    = Table.AddColumn(AñadirAño,      "trim_nro",     each Date.QuarterOfYear([fecha]),                         Int64.Type),
    AñadirTrimTexto  = Table.AddColumn(AñadirTrimNro,  "trim",         each 
                            let q = Date.QuarterOfYear([fecha]) in
                            if q = 1 then "1er trim"
                            else if q = 2 then "2do trim"
                            else if q = 3 then "3er trim"
                            else "4to trim"
                        , type text),
    AñadirMesLargo   = Table.AddColumn(AñadirTrimTexto,"mes_largo",    each Text.Proper(Date.ToText([fecha], "MMMM", "es-ES")),   type text),
    AñadirMesCorto   = Table.AddColumn(AñadirMesLargo, "mes_corto",    each Text.Proper(Date.ToText([fecha], "MMM",  "es-ES")),   type text),
    AñadirMesNro     = Table.AddColumn(AñadirMesCorto, "mes_nro",      each Date.Month([fecha]),                                 Int64.Type),
    AñadirMesInicio  = Table.AddColumn(AñadirMesNro,   "mes_inicia",   each #date(Date.Year([fecha]), Date.Month([fecha]), 1),  type date),
    AñadirMesTermino = Table.AddColumn(AñadirMesInicio,"mes_termina",  each Date.EndOfMonth([fecha]),                           type date),
    AñadirSemanaNro  = Table.AddColumn(AñadirMesTermino,"semana_nro",   each Date.WeekOfYear([fecha], Day.Monday),                Int64.Type),
    AñadirSemanaTxt  = Table.AddColumn(AñadirSemanaNro,"semana_texto", each "Sem. Nro " & Text.From(Date.WeekOfYear([fecha], Day.Monday)), type text),
    AñadirDiaNro     = Table.AddColumn(AñadirSemanaTxt, "dia_nro",      each Date.DayOfWeek([fecha], Day.Monday) + 1,             Int64.Type),
    AñadirDiaLargo   = Table.AddColumn(AñadirDiaNro,    "dia_largo",    each Text.Proper(Date.ToText([fecha], "dddd", "es-ES")), type text),
    AñadirDiaCorto   = Table.AddColumn(AñadirDiaLargo,  "dia_corto",    each Text.Proper(Date.ToText([fecha], "ddd",  "es-ES")), type text)

in
    AñadirDiaCorto